# CCP.RoleAccessScanner

‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Controller, Action ‡πÅ‡∏•‡∏∞ Role/Policy ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÉ‡∏ô ASP.NET Core MVC Project ‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏≤‡∏á
‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡πà‡∏ß‡∏¢‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û

---

## ‚ú® ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡∏´‡∏•‡∏±‡∏Å

* ‡∏™‡πÅ‡∏Å‡∏ô Controller ‡πÅ‡∏•‡∏∞ Action ‡∏ó‡∏∏‡∏Å‡∏ï‡∏±‡∏ß‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡∏û‡∏£‡πâ‡∏≠‡∏° Role/Policy
* ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ `[Authorize]` ‡∏ó‡∏±‡πâ‡∏á‡∏£‡∏∞‡∏î‡∏±‡∏ö Controller ‡πÅ‡∏•‡∏∞ Method
* ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö `appsettings.json` Role Mapping
* ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö `[RemarkPage]` ‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡πÜ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏ô View
* ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ô‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ
* ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ Model ‡πÅ‡∏•‡∏∞ DbSet ‡∏à‡∏≤‡∏Å‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ú‡∏π‡∏Å‡∏Å‡∏±‡∏ö Model ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡πÅ‡∏û‡∏Ñ‡πÄ‡∏Å‡∏à

---

## ‚úÖ ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°

### 1. ‡πÇ‡∏û‡∏£‡πÑ‡∏ü‡∏•‡πå NuGet Package

‡πÉ‡∏ô Git Repo ‡∏à‡∏∞‡∏°‡∏µ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÅ‡∏¢‡∏Å‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô 2 ‡∏™‡πà‡∏ß‡∏ô:

* `/CCP.RoleAccessScanner` ‚Üí ‡∏ï‡∏±‡∏ß‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡πÅ‡∏û‡∏Ñ‡πÄ‡∏Å‡∏à (Library)
* `/TEST` ‚Üí ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ Package

---

## üìÖ ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏û‡∏Ñ‡πÄ‡∏Å‡∏à‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡∏≠‡∏∑‡πà‡∏ô

### üìë Visual Studio

1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà `Tools > NuGet Package Manager > Package Sources`
2. ‡πÄ‡∏û‡∏¥‡πà‡∏° Source ‡πÉ‡∏´‡∏°‡πà:

   * **Name**: CCP.Local
   * **Path**: `\\ccpnas\dep-it\25.Programmer\MyNuGets\CCP.RoleAccessScanner`
3. ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏ú‡πà‡∏≤‡∏ô Package Manager Console:

```bash
Install-Package CCP.RoleAccessScanner -Source CCP.Local
```

### üíª VS Code / .NET CLI

```bash
dotnet add package CCP.RoleAccessScanner --source \\ccpnas\dep-it\25.Programmer\MyNuGets\CCP.RoleAccessScanner
```

---

## üìÑ ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Package

### 1. ‡πÄ‡∏û‡∏¥‡πà‡∏° Role Mapping ‡πÉ‡∏ô `appsettings.json`

```json
"AuthorizationPolicies": {
  "Admin": ["SystemAll", "Admin"],
  "Manager": ["SystemAll", "Manager"],
  "User": ["SystemAll", "Admin", "User"]
}
```

### 2.¬† ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Model ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å¬†scaffold ‡πÄ‡∏õ‡πá‡∏ô¬†partial class ‡πÅ‡∏•‡∏∞ Implement Interface `IRoleAccessRecord`¬†

```csharp
using CCP.RoleAccessScanner.Interfaces;

public partial class RoleAccessLog : IRoleAccessRecord
{
    public string ProjectId { get; set; }
    public string ProjectName { get; set; }
    public string Controller { get; set; }
    public string Action { get; set; }
    public string Role { get; set; }
    public string? Type { get; set; }
    public string? Remark { get; set; }
    public DateTime LoggedAt { get; set; }
}
```

### 3. ‡πÄ‡∏û‡∏¥‡πà‡∏° DbSet ‡πÉ‡∏ô DbContext ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì

```csharp
public DbSet<RoleAccessLog> RoleAccessLogs { get; set; }
```

### 4. ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÉ‡∏ô `Program.cs`

```csharp
builder.Services.AddRoleAccessScanner<AppDbContext, RoleAccessLog>(
    configuration: builder.Configuration,
    projectId: "PROJ-001",
    projectName: "‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô"
);
```

### 5. ‡πÉ‡∏ä‡πâ Attribute `[RemarkPage]` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡∏ô‡πâ‡∏≤

```csharp
private readonly remarkPage = "‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ";
[Authorize("Admin")]
[RemarkPage(remarkPage)]
public IActionResult Index() => View();
```

---

## üèÅ ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó Action ‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÅ‡∏¢‡∏Å

| ‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞                                        | ‡∏°‡∏µ View | HTTP Method | ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó |
| --------------------------------------------- | ------- | ----------- | -------------- |
| GET ‡∏ó‡∏µ‡πà‡∏°‡∏µ View                                | ‚úî       | GET         | Page           |
| POST/PUT/DELETE ‡∏°‡∏µ View ‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏µ button/btn | ‚úî/‚ùå     | POST        | Button         |
| ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ                                        | ‚ùå       | -           | Event          |

> ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ Method ‡∏ó‡∏±‡πâ‡∏á `GET` ‡πÅ‡∏•‡∏∞ `POST` ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô ‡∏°‡∏µ View ‚Äî ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡πÅ‡∏Ñ‡πà `GET` ‡πÄ‡∏õ‡πá‡∏ô Page ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô

---

## ‚öñÔ∏è ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô Controller

```csharp
private readonly remarkPage = "‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ";
[Authorize("Admin")]
public class EmployeeController : Controller
{
    [RemarkPage(remarkPage)]
    public IActionResult Index() => View();

    [HttpPost]
    public IActionResult Save(Employee model)
    {
        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        return RedirectToAction("Index");
    }
}
```

---

## üöÄ ‡∏Å‡∏≤‡∏£ Build ‡πÅ‡∏•‡∏∞ Pack NuGet

```bash
dotnet pack -c Release
```

* ‡πÑ‡∏ü‡∏•‡πå `.nupkg` ‡∏à‡∏∞‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô `bin/Release/`
* ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏õ‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà `\\ccpnas\dep-it\25.Programmer\MyNuGets\CCP.RoleAccessScanner`

---

## üí¨ ‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏õ‡∏±‡∏ç‡∏´‡∏≤

‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ó‡∏µ‡∏° Programmer CCP ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏¥‡∏î Issue ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô Git Repository ‡∏Ç‡∏≠‡∏á‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£
